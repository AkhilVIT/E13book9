<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
<title>Using turn.js and the new zoom feature</title>
<meta name="viewport" content="width = 1050, user-scalable = no" />
<script type="text/javascript" src="../../extras/jquery.min.1.7.js"></script>
<script type="text/javascript" src="../../extras/modernizr.2.5.3.min.js"></script>
<script type="text/javascript" src="../../lib/hash.js"></script>

<style>
	body{
		background: linear-gradient(90deg,#86fde8,#fff);
	}
	#dk-bg{
    width: 100%;
    height: 80vh;
    position: fixed;
    display: block;
    margin: 0;
    background: linear-gradient(to right, #86fde8, white);
    top:0;
    z-index: 1; 
    position: absolute;
    top: 65px;
}

.background-bottom{
    background: linear-gradient(to right, #86fde8, white);
    height: 20vh;
    width: 100%;
  }
</style>
</head>
<body>
	<svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" id="dk-bg" style="z-index:0;position:absolute;top:0;left:0;right:0;bottom:0;"  width={1366} height={654} preserveAspectRatio="xMidYMid" viewBox="0 0 1366 654">
        <g transform><g transform="translate(1060.7731114168175,33.969137648512) scale(100)" opacity="0.4">
            <path d="M4.637569999999999 0 C4.637569999999999 1.0996299999999999 4.814496479158203 1.5099074852365173 4.264681479158203 2.4622149999999996 S3.271092514763482 3.4664384318285983 2.318785 4.0162534318285985 S1.09963 4.92443 3.0153437185626e-16 4.92443 S-1.3664774852365165 4.566068431828598 -2.3187849999999988 4.0162534318285985 S-3.7148664791582022 3.4145225147634837 -4.264681479158202 2.462215000000002 S-4.637569999999999 1.0996300000000006 -4.637569999999999 5.67938525632179e-16 S-4.814496479158204 -1.5099074852365164 -4.264681479158204 -2.4622149999999987 S-3.2710925147634837 -3.466438431828597 -2.318785000000002 -4.016253431828598 S-1.0996300000000008 -4.92443 -9.046031155687801e-16 -4.92443 S1.3664774852365138 -4.566068431828599 2.3187849999999965 -4.0162534318286 S3.714866479158201 -3.414522514763484 4.2646814791582015 -2.4622150000000023 S4.637569999999999 -1.099630000000001 4.637569999999999 -1.135877051264358e-15" fill="#ff00ff" strokeWidth={0}>
              <animateTransform attributeName="transform" type="rotate" dur="10s" repeatCount="indefinite" values="0;60" />
            </path>
          </g><g transform="translate(1136.327733700181,-24.637034821785562) scale(100)" opacity="0.4">
            <path d="M5.565083999999999 0 C5.565083999999999 1.3195559999999995 5.777395774989842 1.8118889822838204 5.117617774989843 2.954657999999999 S3.925311017716178 4.1597261181943175 2.782542 4.819504118194318 S1.319556 5.909315999999999 3.6184124622751194e-16 5.909315999999999 S-1.6397729822838196 5.479282118194318 -2.782541999999998 4.819504118194319 S-4.457839774989842 4.097427017716179 -5.117617774989842 2.954658000000001 S-5.565083999999999 1.3195560000000002 -5.565083999999999 6.815262307586147e-16 S-5.777395774989843 -1.8118889822838191 -5.117617774989844 -2.9546579999999976 S-3.9253110177161803 -4.159726118194317 -2.782542000000002 -4.819504118194317 S-1.3195560000000006 -5.909315999999999 -1.0855237386825359e-15 -5.909315999999999 S1.639772982283817 -5.47928211819432 2.782541999999996 -4.81950411819432 S4.457839774989841 -4.09742701771618 5.117617774989841 -2.954658000000002 S5.565083999999999 -1.3195560000000008 5.565083999999999 -1.3630524615172295e-15" fill="#00c6ff" strokeWidth={0}>
              <animateTransform attributeName="transform" type="rotate" dur="5s" repeatCount="indefinite" values="0;60" />
            </path>
          </g><g transform="translate(1317.6588271802534,-165.29184875049975) scale(100)" opacity="0.4">
            <path d="M7.791117599999999 0 C7.791117599999999 1.8473783999999995 8.088354084985781 2.536644575197349 7.164664884985782 4.136521199999999 S5.4954354248026505 5.823616565472045 3.8955588000000003 6.747305765472045 S1.8473784 8.2730424 5.065777447185168e-16 8.2730424 S-2.2956821751973475 7.670994965472045 -3.8955587999999977 6.747305765472046 S-6.24097568498578 5.736397824802652 -7.16466488498578 4.1365212000000025 S-7.791117599999999 1.8473784000000004 -7.791117599999999 9.541367230620608e-16 S-8.088354084985781 -2.536644575197347 -7.164664884985783 -4.136521199999997 S-5.495435424802652 -5.823616565472044 -3.895558800000003 -6.747305765472045 S-1.847378400000001 -8.2730424 -1.5197332341555504e-15 -8.2730424 S2.2956821751973435 -7.670994965472047 3.895558799999994 -6.747305765472048 S6.240975684985779 -5.736397824802653 7.164664884985779 -4.136521200000003 S7.791117599999998 -1.8473784000000015 7.791117599999999 -1.9082734461241216e-15" fill="#00ffff" strokeWidth={0}>
              <animateTransform attributeName="transform" type="rotate" dur="3.333333333333333s" repeatCount="indefinite" values="0;60" />
            </path>
          </g></g>
    </svg>
	<div className="background-bottom"></div>
<div id="canvas" style="z-index: 500;">
<div class="zoom-icon zoom-icon-in"></div>
<div class="magazine-viewport" id="magazine-viewport">
	<div class="container" >
		<div class="magazine">
			<!-- Next button -->
			<div ignore="1" class="next-button">
				<span style='font-size:25px;margin-top: 48%;color: #fff;position: absolute;top: 46%;left: 2px;'>&#9654;</span>
			</div>
			<!-- Previous button -->
			<div ignore="1" class="previous-button">
				<span style='font-size:25px;margin-top: 48%;color: #fff;position: absolute;top: 46%;right: 2px;'>&#9664;</span>
			</div>
		</div>
	</div>
</div>

<!-- Thumbnails -->
<div class="thumbnails" >
	<div>
		<ul>
			<li class="i">
				<img src="pages/1.jpg" width="76" height="100" class="page-1">
				<span>1</span>
			</li>
			<li class="d">
				<img src="pages/2.jpg" width="76" height="100" class="page-2">
				<img src="pages/3.jpg" width="76" height="100" class="page-3">
				<span>2-3</span>
			</li>
			<li class="d">
				<img src="pages/4.jpg" width="76" height="100" class="page-4">
				<img src="pages/5.jpg" width="76" height="100" class="page-5">
				<span>4-5</span>
			</li>
			<li class="i">
				<img src="pages/6.jpg" width="76" height="100" class="page-6">
				<span>6</span>
			</li>
		<ul>
	<div>	
</div>


<script type="text/javascript">

function loadApp() {

 	$('#canvas').fadeIn(1000);

 	var flipbook = $('.magazine');

 	// Check if the CSS was already loaded
	
	if (flipbook.width()==0 || flipbook.height()==0) {
		setTimeout(loadApp, 10);
		return;
	}
	
	// Create the flipbook

	flipbook.turn({
			
			// Magazine width

			width:848,

			// Magazine height

			height: 600,

			// Duration in millisecond

			duration: 1000,

			// Hardware acceleration

			acceleration: !isChrome(),

			// Enables gradients

			gradients: true,
			
			// Auto center this flipbook

			autoCenter: true,

			// Elevation from the edge of the flipbook when turning a page

			elevation: 50,

			// The number of pages

			pages: 6,

			// Events

			when: {
				turning: function(event, page, view) {
					
					var book = $(this),
					currentPage = book.turn('page'),
					pages = book.turn('pages');
			
					// Update the current URI

					Hash.go('page/' + page).update();

					// Show and hide navigation buttons

					disableControls(page);
					

					$('.thumbnails .page-'+currentPage).
						parent().
						removeClass('current');

					$('.thumbnails .page-'+page).
						parent().
						addClass('current');



				},

				turned: function(event, page, view) {

					disableControls(page);

					$(this).turn('center');

					if (page==1) { 
						$(this).turn('peel', 'br');
					}

				},

				missing: function (event, pages) {

					// Add pages that aren't in the magazine

					for (var i = 0; i < pages.length; i++)
						addPage(pages[i], $(this));

				}
			}

	});

	// Zoom.js

	$('.magazine-viewport').zoom({
		flipbook: $('.magazine'),

		max: function() { 
			
			return largeMagazineWidth()/$('.magazine').width();

		}, 

		when: {

			swipeLeft: function() {

				$(this).zoom('flipbook').turn('next');

			},

			swipeRight: function() {
				
				$(this).zoom('flipbook').turn('previous');

			},

			resize: function(event, scale, page, pageElement) {

				if (scale==1)
					loadSmallPage(page, pageElement);
				else
					loadLargePage(page, pageElement);

			},

			zoomIn: function () {

				$('.thumbnails').hide();
				$('.made').hide();
				$('.magazine').removeClass('animated').addClass('zoom-in');
				$('.zoom-icon').removeClass('zoom-icon-in').addClass('zoom-icon-out');
				
				if (!window.escTip && !$.isTouch) {
					escTip = true;

					$('<div />', {'class': 'exit-message'}).
						html('<div>Press ESC to exit</div>').
							appendTo($('body')).
							delay(2000).
							animate({opacity:0}, 500, function() {
								$(this).remove();
							});
				}
			},

			zoomOut: function () {

				$('.exit-message').hide();
				$('.thumbnails').fadeIn();
				$('.made').fadeIn();
				$('.zoom-icon').removeClass('zoom-icon-out').addClass('zoom-icon-in');

				setTimeout(function(){
					$('.magazine').addClass('animated').removeClass('zoom-in');
					resizeViewport();
				}, 0);

			}
		}
	});

	// Zoom event

	if ($.isTouch)
		$('.magazine-viewport').bind('zoom.doubleTap', zoomTo);
	else
		$('.magazine-viewport').bind('zoom.tap', zoomTo);


	// Using arrow keys to turn the page

	$(document).keydown(function(e){

		var previous = 37, next = 39, esc = 27;

		switch (e.keyCode) {
			case previous:

				// left arrow
				$('.magazine').turn('previous');
				e.preventDefault();

			break;
			case next:

				//right arrow
				$('.magazine').turn('next');
				e.preventDefault();

			break;
			case esc:
				
				$('.magazine-viewport').zoom('zoomOut');	
				e.preventDefault();

			break;
		}
	});

	// URIs - Format #/page/1 

	Hash.on('^page\/([0-9]*)$', {
		yep: function(path, parts) {
			var page = parts[1];

			if (page!==undefined) {
				if ($('.magazine').turn('is'))
					$('.magazine').turn('page', page);
			}

		},
		nop: function(path) {

			if ($('.magazine').turn('is'))
				$('.magazine').turn('page', 1);
		}
	});


	$(window).resize(function() {
		resizeViewport();
	}).bind('orientationchange', function() {
		resizeViewport();
	});

	// Events for thumbnails

	$('.thumbnails').click(function(event) {
		
		var page;

		if (event.target && (page=/page-([0-9]+)/.exec($(event.target).attr('class'))) ) {
		
			$('.magazine').turn('page', page[1]);
		}
	});

	$('.thumbnails li').
		bind($.mouseEvents.over, function() {
			
			$(this).addClass('thumb-hover');

		}).bind($.mouseEvents.out, function() {
			
			$(this).removeClass('thumb-hover');

		});

	if ($.isTouch) {
	
		$('.thumbnails').
			addClass('thumbanils-touch').
			bind($.mouseEvents.move, function(event) {
				event.preventDefault();
			});

	} else {

		$('.thumbnails ul').mouseover(function() {

			$('.thumbnails').addClass('thumbnails-hover');

		}).mousedown(function() {

			return false;

		}).mouseout(function() {

			$('.thumbnails').removeClass('thumbnails-hover');

		});

	}


	// Regions

	if ($.isTouch) {
		$('.magazine').bind('touchstart', regionClick);
	} else {
		$('.magazine').click(regionClick);
	}

	// Events for the next button

	$('.next-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('next-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('next-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('next-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('next-button-down');

	}).click(function() {
		
		$('.magazine').turn('next');

	});

	// Events for the next button
	
	$('.previous-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('previous-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('previous-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('previous-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('previous-button-down');

	}).click(function() {
		
		$('.magazine').turn('previous');

	});


	resizeViewport();

	$('.magazine').addClass('animated');

}

// Zoom icon

 $('.zoom-icon').bind('mouseover', function() { 
 	
 	if ($(this).hasClass('zoom-icon-in'))
 		$(this).addClass('zoom-icon-in-hover');

 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).addClass('zoom-icon-out-hover');
 
 }).bind('mouseout', function() { 
 	
 	 if ($(this).hasClass('zoom-icon-in'))
 		$(this).removeClass('zoom-icon-in-hover');
 	
 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).removeClass('zoom-icon-out-hover');

 }).bind('click', function() {

 	if ($(this).hasClass('zoom-icon-in'))
 		$('.magazine-viewport').zoom('zoomIn');
 	else if ($(this).hasClass('zoom-icon-out'))	
		$('.magazine-viewport').zoom('zoomOut');

 });

 $('#canvas').hide();


// Load the HTML4 version if there's not CSS transform

yepnope({
	test : Modernizr.csstransforms,
	yep: ['../../lib/turn.js'],
	nope: ['../../lib/turn.html4.min.js'],
	both: ['../../lib/zoom.min.js', 'js/magazine.js', 'css/magazine.css'],
	complete: loadApp
});

        
        
</script>

</body>
</html>